#include ../version
#include ../bindings
layout(location=BINDING_IN_POSITION) in vec3  in_position;
layout(location=BINDING_IN_COLOUR) in vec3  in_colour;
layout(location=BINDING_IN_INDICES_OF_MATRICES) in ivec3  in_indices_of_matrices;
layout(location=BINDING_IN_WEIGHTS_OF_MATRICES) in vec3  in_weights_of_matrices;
layout(location=BINDING_OUT_COLOUR) out vec4  out_colour;
uniform uint NUM_MATRICES_PER_VERTEX;
uniform mat4  TRANSFORM_MATRIX_TRANSPOSED[MAX_TRANSFORM_MATRICES];
void main() {
    int i;
    vec4 result_position = vec4(0.0f, 0.0f, 0.0f, 0.0f);
    for (i = 0; i != NUM_MATRICES_PER_VERTEX; ++i)
    {
        const vec4 pos = vec4(in_position,1.0f) *
                         TRANSFORM_MATRIX_TRANSPOSED[in_indices_of_matrices[i]];
        result_position = result_position + in_weights_of_matrices[i] * pos;
    }
    gl_Position = result_position;
    out_colour = vec4(in_colour,1.0f);
}
